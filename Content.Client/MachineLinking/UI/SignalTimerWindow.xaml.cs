using Robust.Client.UserInterface.CustomControls;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.XAML;
using Content.Shared.MachineLinking;

namespace Content.Client.MachineLinking.UI
{
    [GenerateTypedNameReferences]
    public sealed partial class SignalTimerWindow : DefaultWindow
    {
        public event Action<string>? OnCurrentTextEntered;

        public event Action<string>? OnCurrentDelayMinutesEntered;

        public event Action<string>? OnCurrentDelaySecondsEntered;

        private readonly SignalTimerBoundUserInterface _owner;

        public SignalTimerWindow(SignalTimerBoundUserInterface owner)
        {
            RobustXamlLoader.Load(this);

            _owner = owner;

            CurrentTextEdit.OnTextEntered += e => OnCurrentTextEntered?.Invoke(e.Text);
            CurrentDelayEditMinutes.OnTextEntered += e => OnCurrentDelayMinutesEntered?.Invoke(e.Text);
            CurrentDelayEditSeconds.OnTextEntered += e => OnCurrentDelaySecondsEntered?.Invoke(e.Text);
            StartTimer.OnPressed += _ => _owner.OnStartTimer();
        }

        public void SetCurrentText(string text)
        {
            CurrentTextEdit.Text = text;
        }

        public void SetCurrentDelayMinutes(string delay)
        {
            CurrentDelayEditMinutes.Text = delay;
        }

        public void SetCurrentDelaySeconds(string delay)
        {
            CurrentDelayEditSeconds.Text = delay;
        }

        public TimeSpan GetDelay()
        {
            double.TryParse(CurrentDelayEditMinutes.Text, out var minutes);
            double.TryParse(CurrentDelayEditSeconds.Text, out var seconds);
            return TimeSpan.FromMinutes(minutes) + TimeSpan.FromSeconds(seconds);
        }
    }
}
