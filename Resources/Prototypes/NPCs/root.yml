# Specific Root compound tasks being used for NPCs.

# Tries to shoot a target in LOS in range.
- type: htnCompound
  id: TurretCompound
  branches:
    - tasks:
        - !type:HTNCompoundTask
          task: GunCombatCompound
    - tasks:
        - !type:HTNCompoundTask
          task: IdleSpinCompound

# TODO: Need a thing to recharge a laser gun
# TODO: When selecting pickup guns also add chargers or easy container grabs.

- type: htnCompound
  id: RangedCompound
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
        - !type:HTNPrimitiveTask
          operator: !type:RangedCombatOperator
        - !type:HTNPrimitiveTask
          operator: !type:JukeOperator
            type: AdjacentTile
    # Shoot if ammo
#    - tasks:
#        - id: GunCombatCompound
#      preconditions:
#        - !type:GunAmmoPrecondition
#          minPercent: 0.001
#    # TODO: Equip a gun from inventory if one found, preferring over pickup.
#
#    # Pickup ammo if any nearby
#    # TODO: Need nearby ammo
#    #- tasks:
#    #    - id: GunAmmoPickupCompound
#    #  preconditions:
#    #    - !type:GunAmmoPrecondition
#    #      maxPercent: 0.0
#    # Discard gun if no ammo
#    - tasks:
#        - !type:HTNPrimitiveTask
#           preconditions:
#           - !type:ActiveHandEntityPrecondition
#           operator: !type:DropOperator
#      preconditions:
#        - !type:ActiveHandComponentPrecondition
#          components:
#            - type: Gun
#        - !type:GunAmmoPrecondition
#          maxPercent: 0.001
#    # Pickup gun if no ammo
#    - tasks:
#        - id: PickupGunCompound
#      preconditions:
#        - !type:ActiveHandComponentPrecondition
#          components:
#            - type: Gun
#          invert: true


# Changes:
# Make melee combat and movement separate
# Melee just does the hit and then moves at the target.
# If target out of double melee range then fail.
